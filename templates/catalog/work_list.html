{% extends "_base.html" %}
{% block content %}
    <div class="container mt-4">
        <h1 class="text-center mb-1">{{ heading }}</h1>
        <p class="text-center" style="font-size: 1em;">{{ sub_heading }}</p>


        <div class="text-center mb-4">
            <a href="{% url 'work_list' %}"
               class="btn btn-sm btn-outline-primary {% if view_type == 'works' %}active{% endif %}">Works</a>
            <a href="{% url 'bookset_list' %}"
               class="btn btn-sm btn-outline-primary {% if view_type == 'booksets' %}active{% endif %}">Book Sets</a>
            {#            <a href="{% url 'catalog_all' %}"#}
            {#               class="btn btn-sm btn-outline-primary {% if view_type == 'all' %}active{% endif %}">All</a>#}
        </div>
        <div class="container mt-3 list-container">

            {% if items %}
                <div class="list-group shadow-sm">
                    {% for item in items %}
                        <div class="list-group-item list-group-item-action d-flex justify-content-between align-items-start py-2 catalog-item position-relative outer-link"
                             data-url="{{ item.get_absolute_url }}" style="min-height: 117px;">

                            <!-- LEFT -->
                            <div>
                                <h6 class="mb-0 fw-semibold">
                                    {{ item.title }}
                                    <span class="small fw-lighter">
                                        {% if item.kind == "BookSet" %}
                                            {% if item.is_box_set %}(Box Set){% else %}(Set){% endif %}
                                        {% else %}
                                            ({{ item.get_work_type_display }})
                                        {% endif %}
                                    </span>
                                </h6>

                                {#                                <div><span class="small fw-light">{{ item.author }}</span></div>#}
                                {##}
                                {##}
                                {#                                {% with vols=item.volumes.all %}#}
                                {#                                    {% if view_type == "booksets" or vols %}#}
                                {#                                        <small class="text-muted">#}
                                {#                                            {{ vols|length }} volume{{ vols|length|pluralize }}#}
                                {#                                        </small>#}
                                {#                                    {% endif %}#}
                                {#                                {% endwith %}#}
                                {##}
                                {#                            </div>#}
                                {##}
                                {##}
                                {#                            <!-- RIGHT: VOLUME LINKS -->#}
                                {#                            {% with vols=item.volumes.all %}#}
                                {#                                <div class="d-flex flex-nowrap overflow-auto">#}
                                {##}
                                {#                                    {% for vol in vols %}#}
                                {#                                        {% if vol.cover_url %}#}
                                {#                                            <a href="{{ vol.get_absolute_url }}">#}
                                {#                                                <img src="{{ vol.cover_url }}"#}
                                {#                                                     alt="Vol cover"#}
                                {#                                                     loading="lazy"#}
                                {#                                                     decoding="async"#}
                                {#                                                     class="rounded ms-1"#}
                                {#                                                     style="height:100px; width:auto; object-fit:cover;">#}
                                {#                                            </a>#}
                                {#                                        {% else %}#}
                                {#                                            <a href="{{ vol.get_absolute_url }}" style="margin-left:5px">#}
                                {#                                                <div class="me-3 d-flex align-items-center justify-content-center bg-light border rounded text-muted p-1"#}
                                {#                                                     style="width:78px; height:100px; font-size:.8em; object-fit:cover; overflow:hidden;">#}
                                {#                                                    {{ vol.title|truncatechars:20 }}#}
                                {#                                                </div>#}
                                {#                                            </a>#}
                                {#                                        {% endif %}#}
                                {#                                    {% endfor %}#}
                                {##}
                                {#                                </div>#}
                                {#                            {% endwith %}#}
                                <div><span class="small fw-light">{{ item.author }}</span></div>

                                {% with vols=item.volumes.all %}
                                    {% if view_type == "booksets" or vols %}
                                        <small class="text-muted">
                                            {{ vols|length }} volume{{ vols|length|pluralize }}
                                        </small>
                                    {% endif %}

                                    </div>

                                    <!-- RIGHT: VOLUME LINKS -->
                                    <div class="d-flex flex-nowrap overflow-auto">

                                        {% for vol in vols %}
                                            {% if vol.cover_src %}
                                                <a href="{{ vol.get_absolute_url }}">
                                                    <img src="{{ vol.cover_src }}"
                                                         alt="Vol cover"
                                                         loading="lazy"
                                                         decoding="async"
                                                         class="rounded ms-1"
                                                         style="height:100px; width:auto; object-fit:cover;">
                                                </a>
                                            {% else %}
                                                <a href="{{ vol.get_absolute_url }}" style="margin-left:5px">
                                                    <div class="me-3 d-flex align-items-center justify-content-center bg-light border rounded text-muted p-1"
                                                         style="width:78px; height:100px; font-size:.8em; object-fit:cover; overflow:hidden;">
                                                        {{ vol.title|truncatechars:20 }}
                                                    </div>
                                                </a>
                                            {% endif %}
                                        {% endfor %}

                                    </div>
                                {% endwith %}


                        </div>


                    {% endfor %}
                </div>
            {% else %}
                <p class="text-center text-muted mt-5">No entries yet.</p>
            {% endif %}
        </div>
    </div>

    <script>
        document.addEventListener("click", function (e) {
            const item = e.target.closest(".outer-link");
            if (!item) return;

            // If the click hit a real link inside, let it behave normally
            if (e.target.closest("a")) return;

            // Otherwise navigate to the row's URL
            window.location = item.dataset.url;
        });
    </script>

{% endblock %}





